{% extends "base.html" %}
{% load static %}

{% block title %}Registration page{% endblock %}


{% block link %}
<link rel="stylesheet" href="{% static 'css/registration.css' %}">
      
{% endblock link %}

{% block style %}
    
{% endblock style %}
    
{% block content2 %}

<div class="d-flex justify-content-center mt-4">
    <h1>Login</h1>
</div>


<div class="container alert alert-warning alert-dismissible fade show" style="display:none" role="alert" id="message">
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<div class="main-w3layouts wrapper">
    <div class="main-agileinfo">
        <div class="agileits-top">
            <form action="#" method="post" id="loginForm">
                {% csrf_token %}
                <input class="text" type="text" name="Username" placeholder="Username" id="username" required="">
                
                <input class="text" style="margin-top:18px;" type="password" name="password" placeholder="Password" id="password" required=""><br>
               
               
                <input type="submit" value="SIGNUP" id="registerBtn" >
            </form>
            <p>Don't have an Account? <a href="#"> Login Now!</a></p>
        </div>
    </div>
    <!-- //copyright -->
    <ul class="colorlib-bubbles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>
{% endblock  %}


{% block script %}
<script>
    document.getElementById("loginForm").addEventListener("submit", function(event) {
        event.preventDefault();
        
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        const query = `
            mutation {
                login(username: "${username}", password: "${password}") {
                    success
                    message
                    token
                    refreshToken
                }
            }
        `;

        fetch("http://127.0.0.1:8000/graphql/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ query: query })
        })
        .then(response => response.json())
        .then(data => {
            if (data.errors) {
                document.getElementById("alert").style.display = "block";
            } else {
                console.log(data); // Handle token, payload, etc. here
                console.log("token---",data.data.login.token);
                console.log("refresh---",data.data.login.refreshToken);
                window.location.href = "/d";
                // console.log("token---",data.token);
                
                
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>


{% endblock %}